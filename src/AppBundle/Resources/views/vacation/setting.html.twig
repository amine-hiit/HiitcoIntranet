{% extends "default/layout.html.twig" %}

{% set title = 'vacation.paramerters' %}
{% set profile = "profile" %}
{% block stylesheet %}
    <link rel="stylesheet" href={{ asset('bower_components/select2/dist/css/select2.min.css') }}>
    <link rel="stylesheet" href={{ asset('bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css') }}>
    <style>
        .spc{margin-right: 50px;}
        .required:after {
            content: " *";
            color: red;
        }
    </style>
{% endblock %}
{% block content %}

    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            {{ 'vacation.paramerters'|trans|capitalize }}
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-users"></i> Espace RH</a></li>
            <li><a href="#">Congé</a></li>
            <li class="active"> {{ 'paramerter'|trans|capitalize }}</li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">

        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <center>
                            <a type="button" class="btn btn-default btn-flat" href="/intranet/my-vacation-requests"> Mes
                                congés </a>
                            <a type="button" class="btn btn-default btn-flat" href="/intranet/sold"> Mon solde </a>
                            <a type="button" class="btn btn-default btn-flat" href="/intranet/hrm/vacation-requests"> Liste des demandes </a>
                            <a type="button" class="btn btn-default btn-flat disabled" href="/intranet/hrm/vacation-setting">  Parrametrage Congés   </a>

                        </center>

                    </div>
                    <div class="box-body">
                        <div class="col-sm-6 col-xs-12">
                            <h3>{{ 'religious.vacations.list'|trans|capitalize }}</h3>
                            <div class="row">
                                <table id="religious-vacations" class="table table-bordered table-hover">
                                    <thead>
                                    <tr class="success">
                                        <th>{{ 'day'|trans|capitalize }}</th>
                                        <th>{{ 'date'|trans|capitalize }}</th>
                                        <th>{{ 'duration'|trans|capitalize }}</th>

                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for vacation in religiousVacations %}
                                    <tr id="vacation-row-{{ vacation.id }}">
                                        <td id="reference-{{ vacation.id }}" colspan="">{{ vacation.reference|trans|capitalize }}
                                            <a class="edit-religious-vacation" id="edit-{{ vacation.id }}"><i class="fa fa-edit fa-"></i></a>
                                            <a class="delete-religious-vacation" id="delete-{{ vacation.id }}"><i class="fa fa-trash fa-" style="color:darkred;" ></i></a>
                                        </td>
                                        <td id="start-date-{{ vacation.id }}">{{ vacation.startDate|date('d/m/Y') }}</td>
                                        <td id="duration-{{ vacation.id }}"> </td>
                                    </tr>
                                    {% endfor %}
                                    </tbody>

                                </table>
                            </div>
                        </div>
                        <div class="col-sm-6 col-xs-12">
                            <h3>{{ 'add.religious.vacation.day'|trans|capitalize }}</h3>

                            <div class="row">
                                {{ form_start(religiousVacationForm) }}
                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">

                                        {{ form_label(religiousVacationForm.reference, 'reference'|trans|capitalize) }}
                                        <div class="input-group " style="width: 100%;">
                                            {{ form_widget(religiousVacationForm.reference, {'attr':{
                                                'class':'form-control flat  ',
                                                'style': 'width: 100%;'
                                            }}) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">

                                        {{ form_label(religiousVacationForm.startDate, 'date'|trans|capitalize) }}
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            {{ form_widget(religiousVacationForm.startDate, {'attr':{
                                                'class':'form-control pull-right datepicker'
                                            }}) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-xs-12  ">
                                    <div class="row">
                                        <div class="col-sm-12 col-xs-12">
                                            <div class="form-group">
                                                <button type="submit" class="btn bg-navy btn-flat  " style="width:100%;">{{ 'submit'|trans|capitalize }}</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {{ form_end(religiousVacationForm) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    <script src="{{ asset('bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.js') }}"></script>
    <script src="{{ asset('bower_components/select2/dist/js/select2.js') }}"></script>
    <script src="{{ asset('bower_components/datatables.net/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>
    <script>
        $(document).ready(function () {
            function reloadLisstners(){
                cancelReligiousCacationClick();
                $('.datepicker').datepicker({
                    autoclose: true,
                    format: 'dd/mm/yyyy'
                });
                $('.select2').select2();
                $(function () {
                    $('#religious-vacations').DataTable({
                        'paging': true,
                        'lengthChange': false,
                        'searching': false,
                        'ordering': false,
                        'info': false,
                        'autoWidth': true
                    });
                });
            }
            $('.edit-religious-vacation').click(function () {

                if ($(this).hasClass('dirty'))
                    return
                $(this).addClass('dirty')
                var id = $(this).attr('id').split('-')[1];
                $.ajax({
                    type: "GET",
                    url: "/intranet/hrm/edit-religious-vacation/"+id,
                    success: function(editForm){
                        editForm = "<td colspan='3' id = 'edit-td-"+id+"'>"+editForm+"</td>";
                        $("#vacation-row-"+id).append(editForm);
                        $('#reference-'+id).addClass('hidden');
                        $('#start-date-'+id).addClass('hidden');
                        $('#duration-'+id).addClass('hidden');
                        reloadLisstners();
                    },
                    error: function(){
                        alert("failure");
                    },
                });
            });

            $('.delete-religious-vacation').click(function () {

                $(this).addClass('dirty')
                var id = $(this).attr('id').split('-')[1];
                $.ajax({
                    type: "DELETE",
                    url: "/intranet/hrm/delete-religious-vacation/"+id,
                    success: function(data){
                        $('#vacation-row-'+id).remove();
                        reloadLisstners();
                    },
                    error: function(){
                        alert("failure");
                    },
                });
            });

            /*function submitReligiousCacationClick() {
                $('.submit-religious-vacation').click(function (event) {
                    event.preventDefault();
                    var id = $(this).attr('id').split('-')[3];
                    var form = $(this).closest('form');
                    var form_url = form.attr('action');
                    var form_data = form.serialize();
                    var $inputs = form.input
                    var reference = form.find('input[name="reference"]').val()
                    var startDate = form.find('input[name="startDate"]').val()
                    $.ajax({
                        type: 'POST',
                        url: form_url,
                        data: form_data,
                        success:function (data) {
                            alert(JSON.parse(data).reference);
                            alert(JSON.parse(data).startDate);
                        },
                        error:function() {
                            alert("not ok");
                        }
                    })
                });
            }*/

            function cancelReligiousCacationClick() {
                $('.cancel-religious-vacation-edit').click(function (event) {
                    var id = $(this).attr('id').split('-')[4];
                    $("#edit-td-"+id).remove();
                    $("#edit-"+id).removeClass('dirty');
                    $('#reference-'+id).removeClass('hidden');
                    $('#start-date-'+id).removeClass('hidden');
                    $('#duration-'+id).removeClass('hidden');
                });
            }

        })
    </script>
{% endblock %}

