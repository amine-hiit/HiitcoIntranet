{% extends "default/layout.html.twig" %}

{% set title = "Fiche collaborateur" %}
{% set profile = "profile" %}

{% block stylesheet %}

    <link rel="stylesheet" href="{{ asset('bower_components/select2/dist/css/select2.min.css')}}">
    <link rel="stylesheet" href="{{ asset('bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css')}}">
    <link rel="stylesheet" href="{{ asset('intra/css/file-upload.css')}}">

    <style>

        .form-group .select2-container {
            position: relative;
            z-index: 2;
            float: left;
            width: 100% !important;
            max-width: 100%;
            min-width: 100%;
            margin-bottom: 0;
            display: table;
            table-layout: fixed;
        }

        @media screen and (min-width: 768px) {

        }

        /*upload file*/
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .btn-upload {
            border: 1px solid gray;
            color: gray;
            background-color: white;
            padding: 8px 20px;
            border-radius: 0 px;
            font-size: 12px;
        }

        .upload-btn-wrapper input[type=file] {
            border: 1px solid gray;
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
        }

        /* Hide all steps by default: */
        .tab {
            display: none;
        }
        button:hover {
            opacity: 0.8;
        }

        /* Make circles that indicate the steps of the form: */
        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.2;
        }
        .step.active {
            opacity: 1;
        }

        /* Mark the steps that are finished and valid: */
        .step.finish {
            background-color: #c9d5ea;
        }

        /* if the input is invalid */
        input.invalid {
            background-color: #ffdddd;
        }
        select.invalid {
            background-color: #ffdddd;
        }
        textarea.invalid {
            background-color: #ffdddd;
        }

    </style>
{% endblock %}


{% block content %}



        <!-- Content Header (Page header) -->
        <section class="content-header">

            <h1>
                Fiche Collaborateur:
                <small></small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa  fa-home"></i> Accueil</a></li>
            </ol>
        </section>

        <!-- Main content -->

        <section class="content">

            <!-- Default box -->
            <div class="box">
                <div class="box-body">
                    <!--form id="regForm" action="/action_page.php"-->
                    {{ form_start(form, {'attr': {'id': 'regForm'}}) }}

                    <div class="box-header">
                        <div class=" col-sm-6 ">
                            <h3 class="box-title">Personnal info</h3>
                        </div>
                    </div>
                    <!-- One "tab" for each step in the form: -->

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="tab">
                                <div class="row">

                                    <div class=" col-sm-8">
                                        <div class="row">

                                            <div class=" col-sm-6">

                                                <div class="form-group" >
                                                    {{ form_label(form.username) }}
                                                    {{ form_widget(form.username, {'attr':{
                                                        'class':'form-control',
                                                        'disabled':''
                                                    }}) }}
                                                </div>

                                                <div class="form-group" >
                                                    {{ form_label(form.firstName) }}
                                                    {{ form_widget(form.firstName, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>

                                                <div class="form-group" >
                                                    {{ form_label(form.lastName) }}
                                                    {{ form_widget(form.lastName, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>


                                                <div class="form-group " >
                                                    {{ form_label(form.birthday) }}
                                                    <div class="input-group date">
                                                        <div class="input-group-addon">
                                                            <i class="fa fa-calendar"></i>
                                                        </div>
                                                        {{ form_widget(form.birthday, {'attr':{

                                                            'class':'form-control pull-right datepicker'

                                                        }}) }}
                                                    </div>
                                                </div>
                                            </div>

                                            <div class=" col-sm-6">
                                                <div class="form-group ">
                                                    {{ form_label(form.maritalStatus) }}
                                                    {{ form_widget(form.maritalStatus, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>

                                                <div class="form-group">
                                                    {{ form_label(form.dependentChild) }}
                                                    {{ form_widget(form.dependentChild, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>

                                                <div class="form-group" >
                                                    {{ form_label(form.cnssNumber) }}
                                                    {{ form_widget(form.cnssNumber, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>
                                                <div class="form-group ">
                                                    {{ form_label(form.phoneNumber) }}
                                                    {{ form_widget(form.phoneNumber, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>

                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class=" col-sm-12 col-xs-12 ">
                                                <div class="form-group" >
                                                    {{ form_label(form.address) }}
                                                    {{ form_widget(form.address, {'attr':{

                                                        'class':'form-control'
                                                    }}) }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class=" col-sm-4 ">
                                        <div class=" row">
                                            <div class=" col-sm-10 col-xs-offset-1">
                                                <div class="form-group" >
                                                    <div class="file-upload-box js" id="avatar-upload-box">
                                                        <img width="100%" src={{  asset('/uploads/img/avatar/default_avatar.png') }} id="avatar" class="avatar"/>
                                                        {% form_theme form 'form/file.html.twig' %}
                                                        {{ form_widget(form.avatar.file) }}
                                                        {{ form_label(form.avatar.file) }}

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab">
                                <div class="row">
                                    <div class="col-sm-4 col-xs-12">
                                        <div class="form-group ">
                                            {{ form_label(form.startDate) }}
                                            <div class="input-group date">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                                {{ form_widget(form.startDate, {'attr':{

                                                    'class':'form-control pull-right datepicker'
                                                }}) }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-4 col-xs-12">

                                        <div class="form-group">
                                            {{ form_label(form.currentPosition) }}
                                            {{ form_widget(form.currentPosition, {'attr':{

                                                'class':'form-control'
                                            }}) }}
                                        </div>
                                    </div>
                                    <div class="col-sm-4 col-xs-12">
                                        <div class="form-group">
                                            {{ form_label(form.status) }}
                                            {{ form_widget(form.status, {'attr':{

                                                'class':'form-control'
                                            }}) }}
                                        </div>
                                    </div>
                                </div>
                                {{ form_label(form.experiences) }}
                                <div class="row" >
                                    <div class="col-sm-12 col-xs-12">
                                        <div id="experience-fields-list"
                                             data-prototype=
                                             "
                                                    {% filter escape %}
                                                    {% include '@App/profil/prototype/experience_prototype.html.twig' with { 'item': form.experiences.vars.prototype } %}
                                                    {% endfilter %}
                                             "
                                             data-widget-tags="{{ '<div class="experience"></div>'|e }}">
                                        </div>

                                        <a href="#"
                                           class="add-experience-collection-widget"
                                           data-list="#experience-fields-list"
                                        >
                                            Ajouter experience
                                        </a>
                                    </div>
                                </div>
                                {{ form_label(form.projects) }}
                                <div class="row" >
                                    <div class="col-sm-12 col-xs-12">
                                        <div id="project-fields-list"
                                             data-prototype=
                                             "
                                                    {% filter escape %}
                                                    {% include '@App/profil/prototype/project_prototype.html.twig' with { 'item': form.projects.vars.prototype }%}
                                                    {% endfilter %}
                                             "
                                             data-widget-tags="{{ '<div class="project"></div>'|e }}">
                                        </div>

                                        <a href="#"
                                           class="add-project-collection-widget"
                                           data-list="#project-fields-list"
                                        >
                                            Ajouter projet
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="tab">
                                {{ form_label(form.employee_formations) }}
                                <div class="row" >
                                    <div class="col-sm-12 col-xs-12">
                                        <div id="formation-fields-list"
                                             data-prototype=
                                             "
                                                    {% filter escape %}
                                                    {% include '@App/profil/prototype/formation_prototype.html.twig' with { 'item': form.employee_formations.vars.prototype }%}
                                                    {% endfilter %}
                                             "
                                             data-widget-tags="{{ '<div class="formation"></div>'|e }}">
                                        </div>

                                        <a href="#"
                                           class="add-formation-collection-widget"
                                           data-list="#formation-fields-list"
                                        >
                                            Ajouter formation
                                        </a>
                                    </div>
                                </div>


                                {{ form_label(form.employee_languages) }}
                                <div class="row" >
                                    <div class="col-sm-12 col-xs-12">
                                        <div id="language-fields-list"
                                             data-prototype=
                                             "
                                                    {% filter escape %}
                                                    {% include '@App/profil/prototype/language_prototype.html.twig' with { 'item': form.employee_languages.vars.prototype }%}
                                                    {% endfilter %}
                                             "
                                             data-widget-tags="{{ '<div class="language"></div>'|e }}">
                                        </div>

                                        <a href="#"
                                           class="add-language-collection-widget"
                                           data-list="#language-fields-list"
                                        >
                                            Ajouter langue
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!-- end tab-->
                        </div>
                    </div>
                    <!-- end row -->
                    <div style="float:right;">
                        <button type="button" id="prevBtn" class ="btn bg-navy btn-flat " style= "width: 200px;" onclick="nextPrev(-1)">Previous</button>
                        <button type="button" id="nextBtn" class ="btn bg-navy btn-flat " style= "width: 200px;" onclick="nextPrev(1)">Next</button>
                    </div>
                    <!-- Circles which indicates the steps of the form: -->
                    <div style="text-align:center;margin-top:40px;">
                        <span class="step"></span>
                        <span class="step"></span>
                        <span class="step"></span>
                    </div>
                    {% do form.employee_formations.setRendered %}
                    {% do form.projects.setRendered %}
                    {% do form.experiences.setRendered %}
                    {% do form.employee_languages.setRendered %}
                    {{ form_end(form) }}
                    <!--/form-->
                </div>
            </div>
            <!-- /.box -->

        </section>
    </div>

    <!-- /.content -->
    <!-- /.content-wrapper -->



{% endblock %}


{% block script %}
    {# <script src="{{ asset('https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js')}}"></script>#}
    <script src="{{ asset('bower_components/select2/dist/js/select2.full.min.js')}}"></script>
    <script src="{{ asset('bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js')}}"></script>
    <script src="{{ asset('intra/js/file-upload.js')}}"></script>
    <script src="{{ asset('intra/js/employee-form.js')}}"></script>
{% endblock %}

  {% block javascript %}


      $(function() {
          $("#formation-submit").click(function(){
              var $formationForm = $('#formation-form');

              $.ajax({
                  type: "POST",
                  url: Routing.generate('new-formation'),
                  data: $formationForm.serialize(),
                  success: function(dataF){

                  console.log(dataF);
                      $("#modal-content").modal('hide');
                      var myObject = JSON.parse(dataF);
                      $(".formation-select > option").each(function(){
                           $(this).removeAttr( "selected" );
                      })
                      $(".formation-select").append('<option selected="selected" value="'+myObject.id+'">'+myObject.value+'</option>');
                      $('#formationModal').modal('hide');
                  },
                  error: function(){
                      alert("failure2");
                  }
              });
          });
          $(".other-formation").click(function(){
              $.ajax({
                  type: "GET",
                  url: Routing.generate('new-formation'),
                  success: function(msg){
                  console.log(msg);
                  $("#new-formation-label").empty();
                  $("#new-formation-label").append(msg);
                  },
                  error: function(){
                      alert("failure");
                  }
              });
          });
      });

  {% endblock %}
